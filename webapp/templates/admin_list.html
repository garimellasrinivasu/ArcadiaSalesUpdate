{% extends 'base.html' %}
{% block title %}My Entries - Admin{% endblock %}
{% block content %}
<h1>My Entries</h1>
<div class="card form inline">
  <form method="get" class="inline-form" style="gap:8px">
    <label>Numeric Field
      <select name="nf">
        <option value="">--</option>
        {% for f in ['s_no','total_sale_price','amount_received','balance_amount','balance_tobe_received_by_plan_approval','balance_tobe_received_during_exec'] %}
          <option value="{{ f }}" {% if (request.args.get('nf') or '')==f %}selected{% endif %}>{{ f }}</option>
        {% endfor %}
      </select>
    </label>
    <label>Op
      {% set ops = {'gt':'>','gte':'>=','lt':'<','lte':'<=','eq':'='} %}
      <select name="no">
        {% for k,v in ops.items() %}
          <option value="{{ k }}" {% if (request.args.get('no') or '')==k %}selected{% endif %}>{{ v }}</option>
        {% endfor %}
      </select>
    </label>
    <label>Value
      <input type="number" step="any" name="nv" value="{{ request.args.get('nv') or '' }}">
    </label>
    <button class="btn" type="submit">Apply</button>
    <a class="btn secondary" href="{{ url_for('admin_entries') }}">Clear</a>
  </form>
  <span class="spacer"></span>
  <a class="btn" href="{{ url_for('admin_new') }}">New Sale</a>
</div>

<div class="table-scroll">
<table class="table">
  <thead>
    <tr>
      <th>Actions</th>
      {% set next = 'asc' if sort_dir=='desc' else 'desc' %}
      {% set persist = {'nf':request.args.get('nf') or '', 'no':request.args.get('no') or '', 'nv':request.args.get('nv') or ''} %}
      <th><a href="{{ url_for('admin_entries', sort_by='s_no', sort_dir=(next if sort_by=='s_no' else 'asc'), **persist) }}">S.No</a></th>
      <th><a href="{{ url_for('admin_entries', sort_by='booking_date', sort_dir=(next if sort_by=='booking_date' else 'desc'), **persist) }}">Date</a></th>
      <th><a href="{{ url_for('admin_entries', sort_by='buyer_name', sort_dir=(next if sort_by=='buyer_name' else 'asc'), **persist) }}">Buyer</a></th>
      <th><a href="{{ url_for('admin_entries', sort_by='sale_person_name', sort_dir=(next if sort_by=='sale_person_name' else 'asc'), **persist) }}">Sale Person</a></th>
      <th><a href="{{ url_for('admin_entries', sort_by='total_sale_price', sort_dir=(next if sort_by=='total_sale_price' else 'desc'), **persist) }}">Total</a></th>
      <th><a href="{{ url_for('admin_entries', sort_by='amount_received', sort_dir=(next if sort_by=='amount_received' else 'desc'), **persist) }}">Amount Received</a></th>
      <th><a href="{{ url_for('admin_entries', sort_by='balance_amount', sort_dir=(next if sort_by=='balance_amount' else 'desc'), **persist) }}">Balance</a></th>
      <th><a href="{{ url_for('admin_entries', sort_by='balance_tobe_received_by_plan_approval', sort_dir=(next if sort_by=='balance_tobe_received_by_plan_approval' else 'desc'), **persist) }}">Balance by Plan</a></th>
      <th><a href="{{ url_for('admin_entries', sort_by='balance_tobe_received_during_exec', sort_dir=(next if sort_by=='balance_tobe_received_during_exec' else 'desc'), **persist) }}">During Exec</a></th>
    </tr>
  </thead>
  <tbody>
    {% for r in rows %}
    <tr>
      <td>
        <a class="btn small" href="{{ url_for('admin_edit', rowid=r.rowid) }}">Edit</a>
        <form method="post" action="{{ url_for('admin_delete', rowid=r.rowid) }}" class="inline" onsubmit="return confirm('Delete this entry?');" style="display:inline">
          <button class="btn small danger" type="submit">Delete</button>
        </form>
      </td>
      <td>{{ r.s_no }}</td>
      <td>{{ r.booking_date }}</td>
      <td>{{ r.buyer_name }}</td>
      <td>{{ r.sale_person_name }}</td>
      <td><span class="currency" data-value="{{ r.total_sale_price or 0 }}">{{ r.total_sale_price or 0 }}</span></td>
      <td><span class="currency" data-value="{{ r.amount_received_effective or 0 }}">{{ r.amount_received_effective or 0 }}</span></td>
      <td><span class="currency" data-value="{{ r.balance_amount_effective or 0 }}">{{ r.balance_amount_effective or 0 }}</span></td>
      <td><span class="currency" data-value="{{ r.balance_tobe_received_by_plan_approval or 0 }}">{{ r.balance_tobe_received_by_plan_approval or 0 }}</span></td>
      <td><span class="currency" data-value="{{ r.balance_tobe_received_during_exec or 0 }}">{{ r.balance_tobe_received_during_exec or 0 }}</span></td>
    </tr>
    {% endfor %}
  </tbody>
  </table>
</div>
{% endblock %}
